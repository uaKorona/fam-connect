# üèóÔ∏è Hosting Architecture –¥–ª—è fam-connect

## üìñ –û–≥–ª—è–¥

–î–æ–¥–∞—Ç–æ–∫ —Ç–µ–ø–µ—Ä –ø—ñ–¥—Ç—Ä–∏–º—É—î **–º–æ–¥—É–ª—å–Ω—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É —Ö–æ—Å—Ç–∏–Ω–≥—É** –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º **keep-alive –º–µ—Ö–∞–Ω—ñ–∑–º–æ–º** –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–∞—Å–∏–Ω–∞–Ω–Ω—é —Å–µ—Ä–≤–µ—Ä–∞ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–µ–æ—á–∞—Ç—ñ–≤.

## üîß –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
src/app/services/hosting/
‚îú‚îÄ‚îÄ hosting-provider.interface.ts    # –ó–∞–≥–∞–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ render-hosting.service.ts        # Render-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ –ª–æ–≥—ñ–∫–∞
‚îú‚îÄ‚îÄ local-hosting.service.ts         # –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
‚îú‚îÄ‚îÄ hosting-factory.service.ts       # Factory –¥–ª—è –≤–∏–±–æ—Ä—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
‚îî‚îÄ‚îÄ hosting.service.ts              # –û—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤—ñ—Å
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ö–æ—Å—Ç–∏–Ω–≥—É** - —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. **Keep-alive –ø—ñ–¥ —á–∞—Å –¥–∑–≤—ñ–Ω–∫—ñ–≤** - –∑–∞–ø–æ–±—ñ–≥–∞—î –∑–∞—Å–∏–Ω–∞–Ω–Ω—é —Å–µ—Ä–≤–µ—Ä–∞
3. **–ú–æ–¥—É–ª—å–Ω—ñ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤
4. **–Ü–∑–æ–ª—è—Ü—ñ—è –ª–æ–≥—ñ–∫–∏** - —Ö–æ—Å—Ç–∏–Ω–≥-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π –∫–æ–¥ –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ

## üöÄ –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ö–æ—Å—Ç–∏–Ω–≥–∏

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä   | –°—Ç–∞—Ç—É—Å         | Keep-alive     | –ü—Ä–∏–º—ñ—Ç–∫–∏        |
| ----------- | -------------- | -------------- | --------------- |
| **Render**  | ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | ‚úÖ HTTP ping   | –û—Å–Ω–æ–≤–Ω–∏–π target |
| **Local**   | ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | ‚ùå –ù–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω | –î–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏    |
| **Vercel**  | üîÑ –ü–ª–∞–Ω—É—î—Ç—å—Å—è  | üîÑ Serverless  | –ú–∞–π–±—É—Ç–Ω—î        |
| **Railway** | üîÑ –ü–ª–∞–Ω—É—î—Ç—å—Å—è  | ‚ùå –ù–µ –∑–∞—Å–∏–Ω–∞—î  | –ú–∞–π–±—É—Ç–Ω—î        |

## üîÑ Lifecycle keep-alive

```mermaid
graph TD
    A[–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è] --> B[startCall]
    B --> C[handleHostingKeepAlive: CONNECTING]
    C --> D[hostingService.startCallKeepAlive]
    D --> E[Ping –∫–æ–∂–Ω—ñ 12 —Ö–≤–∏–ª–∏–Ω]
    E --> F[–î–∑–≤—ñ–Ω–æ–∫ –∞–∫—Ç–∏–≤–Ω–∏–π]
    F --> G[–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–µ—Ä—à—É—î –¥–∑–≤—ñ–Ω–æ–∫]
    G --> H[endCall]
    H --> I[hostingService.stopCallKeepAlive]
    I --> J[Keep-alive –∑—É–ø–∏–Ω–µ–Ω–∏–π]
```

## üíª –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

```typescript
// –í video-call.component.ts
ngOnInit(): void {
  this.hostingService.initialize(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
}
```

### Keep-alive —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—Ä—É—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω—É WebRTC
private handleHostingKeepAlive(state: ConnectionState): void {
  switch (state) {
    case ConnectionState.CONNECTING:
    case ConnectionState.WAITING:
      this.hostingService.startCallKeepAlive();
      break;
    case ConnectionState.DISCONNECTED:
    case ConnectionState.ERROR:
      this.hostingService.stopCallKeepAlive();
      break;
  }
}
```

## üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### Environment Detection

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î —Ö–æ—Å—Ç–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤—ñ:

**Server-side:**

- `process.env.RENDER` ‚Üí render
- `process.env.VERCEL` ‚Üí vercel
- `process.env.RAILWAY_ENVIRONMENT` ‚Üí railway

**Client-side:**

- `hostname.includes('.onrender.com')` ‚Üí render
- `hostname === 'localhost'` ‚Üí local

### Custom –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```typescript
// –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
this.hostingService.initialize({
  enabled: true,
  interval: 10 * 60 * 1000, // 10 —Ö–≤–∏–ª–∏–Ω
  serverUrl: 'https://custom-domain.com',
});
```

## üè∑Ô∏è –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –Ω–∞–¥–∞—î –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è:

```javascript
[HostingService] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: render
[render] –ó–∞–ø—É—Å–∫ keep-alive –∑ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 12 —Ö–≤–∏–ª–∏–Ω
[render] Keep-alive ping —É—Å–ø—ñ—à–Ω–∏–π
[HostingService] –ó—É–ø–∏–Ω–∫–∞ keep-alive –ø—ñ—Å–ª—è –≤—ñ–¥–µ–æ—á–∞—Ç—É
```

## ‚ûï –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `vercel-hosting.service.ts`)
2. **–Ü–º–ø–ª–µ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å** `HostingProvider`
3. **–î–æ–¥–∞—Ç–∏ –≤ factory** (`hosting-factory.service.ts`)
4. **–û–Ω–æ–≤–∏—Ç–∏ detection –ª–æ–≥—ñ–∫—É**

```typescript
// vercel-hosting.service.ts
@Injectable({ providedIn: 'root' })
export class VercelHostingService implements HostingProvider {
  // –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ –¥–ª—è Vercel
}
```

## üìä –ü–µ—Ä–µ–≤–∞–≥–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

‚úÖ **–ú–æ–¥—É–ª—å–Ω—ñ—Å—Ç—å** - –∫–æ–∂–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤  
‚úÖ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è** - –º–æ–∂–Ω–∞ –º–æ–∫–∞—Ç–∏ –æ–∫—Ä–µ–º–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤  
‚úÖ **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞** - –∑–º—ñ–Ω–∏ –≤ –æ–¥–Ω–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —ñ–Ω—à—ñ  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è** - –º—ñ–Ω—ñ–º—É–º —Ä—É—á–Ω–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

## üìö –§–∞–π–ª–∏ –¥–ª—è –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è

- `DEPLOYMENT.md` - –¥–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–µ–ø–ª–æ—é –Ω–∞ Render
- `render.yaml` - –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—é
- `src/app/services/hosting/` - –≤—Å—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ö–æ—Å—Ç–∏–Ω–≥—É
